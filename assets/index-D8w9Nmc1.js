var Ee=Object.defineProperty;var Pe=(t,e,r)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var K=(t,e,r)=>Pe(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();function v(){}function ge(t){return t()}function le(){return Object.create(null)}function x(t){t.forEach(ge)}function pe(t){return typeof t=="function"}function j(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let R;function X(t,e){return t===e?!0:(R||(R=document.createElement("a")),R.href=e,t===R.href)}function ke(t){return Object.keys(t).length===0}function V(t,e){t.appendChild(e)}function w(t,e,r){t.insertBefore(e,r||null)}function p(t){t.parentNode&&t.parentNode.removeChild(t)}function _e(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function E(t){return document.createElement(t)}function Z(t){return document.createTextNode(t)}function be(){return Z(" ")}function Me(){return Z("")}function d(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function Se(t){return Array.from(t.childNodes)}function Ce(t,e){e=""+e,t.data!==e&&(t.data=e)}function W(t,e,r,n){r==null?t.style.removeProperty(e):t.style.setProperty(e,r,"")}function Ie(t,e,{bubbles:r=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:r,cancelable:n})}let T;function N(t){T=t}function ee(){if(!T)throw new Error("Function called outside component initialization");return T}function te(t){ee().$$.on_mount.push(t)}function He(t){ee().$$.on_destroy.push(t)}function Le(){const t=ee();return(e,r,{cancelable:n=!1}={})=>{const o=t.$$.callbacks[e];if(o){const l=Ie(e,r,{cancelable:n});return o.slice().forEach(i=>{i.call(t,l)}),!l.defaultPrevented}return!0}}const H=[],se=[];let L=[];const ce=[],Ne=Promise.resolve();let J=!1;function Te(){J||(J=!0,Ne.then(we))}function Q(t){L.push(t)}const G=new Set;let I=0;function we(){if(I!==0)return;const t=T;do{try{for(;I<H.length;){const e=H[I];I++,N(e),xe(e.$$)}}catch(e){throw H.length=0,I=0,e}for(N(null),H.length=0,I=0;se.length;)se.pop()();for(let e=0;e<L.length;e+=1){const r=L[e];G.has(r)||(G.add(r),r())}L.length=0}while(H.length);for(;ce.length;)ce.pop()();J=!1,G.clear(),N(t)}function xe(t){if(t.fragment!==null){t.update(),x(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Q)}}function Ae(t){const e=[],r=[];L.forEach(n=>t.indexOf(n)===-1?e.push(n):r.push(n)),r.forEach(n=>n()),L=e}const O=new Set;let S;function ne(){S={r:0,c:[],p:S}}function re(){S.r||x(S.c),S=S.p}function g(t,e){t&&t.i&&(O.delete(t),t.i(e))}function P(t,e,r,n){if(t&&t.o){if(O.has(t))return;O.add(t),S.c.push(()=>{O.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}else n&&n()}function B(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function oe(t){t&&t.c()}function D(t,e,r){const{fragment:n,after_update:o}=t.$$;n&&n.m(e,r),Q(()=>{const l=t.$$.on_mount.map(ge).filter(pe);t.$$.on_destroy?t.$$.on_destroy.push(...l):x(l),t.$$.on_mount=[]}),o.forEach(Q)}function Y(t,e){const r=t.$$;r.fragment!==null&&(Ae(r.after_update),x(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function Re(t,e){t.$$.dirty[0]===-1&&(H.push(t),Te(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function q(t,e,r,n,o,l,i=null,u=[-1]){const s=T;N(t);const c=t.$$={fragment:null,ctx:[],props:l,update:v,not_equal:o,bound:le(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:le(),dirty:u,skip_bound:!1,root:e.target||s.$$.root};i&&i(c.root);let h=!1;if(c.ctx=r?r(t,e.props||{},(a,f,..._)=>{const b=_.length?_[0]:f;return c.ctx&&o(c.ctx[a],c.ctx[a]=b)&&(!c.skip_bound&&c.bound[a]&&c.bound[a](b),h&&Re(t,a)),f}):[],c.update(),h=!0,x(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const a=Se(e.target);c.fragment&&c.fragment.l(a),a.forEach(p)}else c.fragment&&c.fragment.c();e.intro&&g(t.$$.fragment),D(t,e.target,e.anchor),we()}N(s)}class F{constructor(){K(this,"$$");K(this,"$$set")}$destroy(){Y(this,1),this.$destroy=v}$on(e,r){if(!pe(r))return v;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{const o=n.indexOf(r);o!==-1&&n.splice(o,1)}}$set(e){this.$$set&&!ke(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const We="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(We);function $e(t){return t<=600}function ue(t,e,r){const n=t.slice();return n[8]=e[r],n}function ae(t){let e,r,n,o,l,i,u;return{c(){e=E("a"),r=E("img"),l=be(),d(r,"class","thumbnail svelte-8ifd7i"),X(r.src,n=t[8].url)||d(r,"src",n),d(r,"alt",o="img "+t[8].id),d(e,"id",i=`thumbnail-${t[8].id}`),d(e,"href",u=t[8].url),d(e,"class","thumbnail-wrapper svelte-8ifd7i"),W(e,"left",t[8].posX+"px"),W(e,"top",t[8].posY+"px")},m(s,c){w(s,e,c),V(e,r),V(e,l)},p(s,c){c&1&&!X(r.src,n=s[8].url)&&d(r,"src",n),c&1&&o!==(o="img "+s[8].id)&&d(r,"alt",o),c&1&&i!==(i=`thumbnail-${s[8].id}`)&&d(e,"id",i),c&1&&u!==(u=s[8].url)&&d(e,"href",u),c&1&&W(e,"left",s[8].posX+"px"),c&1&&W(e,"top",s[8].posY+"px")},d(s){s&&p(e)}}}function Oe(t){let e,r=B(t[0]),n=[];for(let o=0;o<r.length;o+=1)n[o]=ae(ue(t,r,o));return{c(){e=E("div");for(let o=0;o<n.length;o+=1)n[o].c()},m(o,l){w(o,e,l);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,[l]){if(l&1){r=B(o[0]);let i;for(i=0;i<r.length;i+=1){const u=ue(o,r,i);n[i]?n[i].p(u,l):(n[i]=ae(u),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=r.length}},i:v,o:v,d(o){o&&p(e),_e(n,o)}}}const M=30;function Xe(t,e,r,n,o,l){return!(t+(o+M)<=r||r+(o+M)<=t||e+(l+M)<=n||n+(l+M)<=e)}function Be(){const t=document.querySelector(".thumbnail");if(!t)return{tMaxWidth:100,tMaxHeight:100};const e=window.getComputedStyle(t),r=parseInt(e.maxWidth)||100,n=parseInt(e.maxHeight)||100;return{tMaxWidth:r,tMaxHeight:n}}function je(t,e,r){let{pageNumber:n}=e,{pageHeight:o}=e,{pageWidth:l}=e,{thumbnails:i=[]}=e;const u=Le();te(async()=>{r(0,i=c()),u("pageRendered",{thumbnailCount:i.length})});function s(){let a=M,f=M;return n==0?{topStart:f,leftStart:a}:($e(l)?f+=n*o:a+=n*l,{topStart:f,leftStart:a})}function c(){const f=[],_=[],{tMaxWidth:b,tMaxHeight:C}=Be(),{topStart:m,leftStart:$}=s();return i.forEach(y=>{let k,A,ie;const U=document.getElementById(`thumbnail-${y.id}`);if(!U)throw new Error(`Cannot find elem thumbnail-${y.id} to set randomised position.`);let z=0;do({posX:k,posY:A}=h($,m,C,b)),ie=f.some(({posX:ye,posY:ve})=>Xe(k,A,ye,ve,b,C)),z++;while(ie&&z<50);f.push({element:U,posX:k,posY:A}),z>=50&&(console.warn(`Skipping thumbnail ${y.id} due to space constraints.`),U.style.display="none"),_.push({...y,posX:k,posY:A})}),_}function h(a,f,_,b){let C=f+o-M-_,m=a+l-M-b;return{posX:Math.floor(Math.random()*(m-a)+a),posY:Math.floor(Math.random()*(C-f)+f)}}return t.$$set=a=>{"pageNumber"in a&&r(1,n=a.pageNumber),"pageHeight"in a&&r(2,o=a.pageHeight),"pageWidth"in a&&r(3,l=a.pageWidth),"thumbnails"in a&&r(0,i=a.thumbnails)},[i,n,o,l]}class De extends F{constructor(e){super(),q(this,e,je,Oe,j,{pageNumber:1,pageHeight:2,pageWidth:3,thumbnails:0})}}function fe(t,e,r){const n=t.slice();return n[1]=e[r].thumbnails,n[14]=r,n}function de(t){let e,r,n=B(t[0]),o=[];for(let i=0;i<n.length;i+=1)o[i]=he(fe(t,n,i));const l=i=>P(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Me()},m(i,u){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(i,u);w(i,e,u),r=!0},p(i,u){if(u&29){n=B(i[0]);let s;for(s=0;s<n.length;s+=1){const c=fe(i,n,s);o[s]?(o[s].p(c,u),g(o[s],1)):(o[s]=he(c),o[s].c(),g(o[s],1),o[s].m(e.parentNode,e))}for(ne(),s=n.length;s<o.length;s+=1)l(s);re()}},i(i){if(!r){for(let u=0;u<n.length;u+=1)g(o[u]);r=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)P(o[u]);r=!1},d(i){i&&p(e),_e(o,i)}}}function he(t){let e,r;return e=new De({props:{thumbnails:t[1],pageNumber:t[14],pageHeight:t[3],pageWidth:t[2]}}),e.$on("pageRendered",t[4]),{c(){oe(e.$$.fragment)},m(n,o){D(e,n,o),r=!0},p(n,o){const l={};o&1&&(l.thumbnails=n[1]),e.$set(l)},i(n){r||(g(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){Y(e,n)}}}function Ye(t){let e,r,n=t[1].length&&de(t);return{c(){e=E("div"),n&&n.c(),d(e,"id","photos-wrapper"),d(e,"class","svelte-18731qk")},m(o,l){w(o,e,l),n&&n.m(e,null),r=!0},p(o,[l]){o[1].length?n?(n.p(o,l),l&2&&g(n,1)):(n=de(o),n.c(),g(n,1),n.m(e,null)):n&&(ne(),P(n,1,1,()=>{n=null}),re())},i(o){r||(g(n),r=!0)},o(o){P(n),r=!1},d(o){o&&p(e),n&&n.d()}}}const me=5,qe="https://rkimmiblogserver.fly.dev/api/photos-blog/thumbnails";function Fe(t,e,r){const n=window.innerWidth,o=window.innerHeight;let l=[],i=0,u="",s=[],c=!1,h=!1;function a(m){i+=m.detail.thumbnailCount,_()}async function f(){if(c)return;c=!0;let $=2*me;await C($),_(),c=!1}function _(){if(i>=s.length)return;const m=s.slice(i,i+me);i++,r(0,l=[...l,{pageStart:i,thumbnails:m}])}te(async()=>{await f(),window.addEventListener("scroll",b)}),He(()=>{window.removeEventListener("scroll",b)});function b(){let m=0,$=0;$e(n)?(m=window.scrollY+window.innerHeight,$=l.length*o-o):(m=window.scrollX+window.innerWidth,$=l.length*n-n),m>=$&&f()}async function C(m){if(h)return;const $=`${qe}?folder=photos-blog&limit=${m}&startKey=${u}`;try{let k=await(await fetch($)).json();r(1,s=[...s,...k.images]),u=k.nextPageStart,k.nextPageStart===""&&(console.log("All thumbnails loaded, total: "+s.length),h=!0)}catch(y){console.error("Error loading thumbnails:",y)}}return[l,s,n,o,a]}class Ue extends F{constructor(e){super(),q(this,e,Fe,Ye,j,{})}}function ze(t){let e;return{c(){e=E("div"),e.textContent="wip photo preview"},m(r,n){w(r,e,n)},p:v,d(r){r&&p(e)}}}function Ke(t){let e,r=t[0].title+"",n,o,l,i,u;return{c(){e=E("h1"),n=Z(r),o=be(),l=E("img"),X(l.src,i=t[0].url)||d(l,"src",i),d(l,"alt",u=t[0].title)},m(s,c){w(s,e,c),V(e,n),w(s,o,c),w(s,l,c)},p(s,c){c&1&&r!==(r=s[0].title+"")&&Ce(n,r),c&1&&!X(l.src,i=s[0].url)&&d(l,"src",i),c&1&&u!==(u=s[0].title)&&d(l,"alt",u)},d(s){s&&(p(e),p(o),p(l))}}}function Ge(t){let e;function r(l,i){return l[0]?Ke:ze}let n=r(t),o=n(t);return{c(){e=E("div"),o.c()},m(l,i){w(l,e,i),o.m(e,null)},p(l,[i]){n===(n=r(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e,null)))},i:v,o:v,d(l){l&&p(e),o.d()}}}function Ve(t,e,r){let{id:n}=e,o;return te(async()=>{if(!o){const l=await fetch(`/api/photos/${n}`);r(0,o=await l.json())}}),t.$$set=l=>{"id"in l&&r(1,n=l.id)},[o,n]}class Je extends F{constructor(e){super(),q(this,e,Ve,Ge,j,{id:1})}}function Qe(t){let e,r;return e=new Ue({}),{c(){oe(e.$$.fragment)},m(n,o){D(e,n,o),r=!0},p:v,i(n){r||(g(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){Y(e,n)}}}function Ze(t){let e,r;return e=new Je({props:{id:t[0]}}),{c(){oe(e.$$.fragment)},m(n,o){D(e,n,o),r=!0},p(n,o){const l={};o&1&&(l.id=n[0]),e.$set(l)},i(n){r||(g(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){Y(e,n)}}}function et(t){let e,r,n,o;const l=[Ze,Qe],i=[];function u(s,c){var h;return(h=s[0])!=null&&h.length?0:1}return r=u(t),n=i[r]=l[r](t),{c(){e=E("main"),n.c(),d(e,"class","svelte-1tyzdic")},m(s,c){w(s,e,c),i[r].m(e,null),o=!0},p(s,[c]){let h=r;r=u(s),r===h?i[r].p(s,c):(ne(),P(i[h],1,1,()=>{i[h]=null}),re(),n=i[r],n?n.p(s,c):(n=i[r]=l[r](s),n.c()),g(n,1),n.m(e,null))},i(s){o||(g(n),o=!0)},o(s){P(n),o=!1},d(s){s&&p(e),i[r].d()}}}function tt(t,e,r){let{photoIdParam:n=null}=e;addEventListener("DOMContentLoaded",()=>{const i=new URLSearchParams(window.location.search);r(0,n=i.get("photo"));const u=document.getElementsByTagName("body")[0],[s,c]=l();u.style.backgroundColor=s,u.style.color=c});const o=new Map([[0,["#ffc0c0","white"]],[12,["#ffffaa","brown"]],[16,["#8affc8","black"]],[20,["#ceceff","white"]]]);function l(){let i="",u="";const c=new Date().getHours();for(let[h,[a,f]]of o)if(c>=h)i=a,u=f;else break;return[i,u]}return t.$$set=i=>{"photoIdParam"in i&&r(0,n=i.photoIdParam)},[n]}class nt extends F{constructor(e){super(),q(this,e,tt,et,j,{photoIdParam:0})}}new nt({target:document.getElementById("app")});
