var Ee=Object.defineProperty;var Pe=(t,e,r)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var K=(t,e,r)=>Pe(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();function v(){}function ge(t){return t()}function le(){return Object.create(null)}function x(t){t.forEach(ge)}function pe(t){return typeof t=="function"}function j(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let R;function X(t,e){return t===e?!0:(R||(R=document.createElement("a")),R.href=e,t===R.href)}function ke(t){return Object.keys(t).length===0}function V(t,e){t.appendChild(e)}function w(t,e,r){t.insertBefore(e,r||null)}function _(t){t.parentNode&&t.parentNode.removeChild(t)}function _e(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function E(t){return document.createElement(t)}function Z(t){return document.createTextNode(t)}function be(){return Z(" ")}function Me(){return Z("")}function h(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function Se(t){return Array.from(t.childNodes)}function Ce(t,e){e=""+e,t.data!==e&&(t.data=e)}function W(t,e,r,n){r==null?t.style.removeProperty(e):t.style.setProperty(e,r,"")}function Ie(t,e,{bubbles:r=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:r,cancelable:n})}let T;function N(t){T=t}function ee(){if(!T)throw new Error("Function called outside component initialization");return T}function te(t){ee().$$.on_mount.push(t)}function He(t){ee().$$.on_destroy.push(t)}function Le(){const t=ee();return(e,r,{cancelable:n=!1}={})=>{const o=t.$$.callbacks[e];if(o){const l=Ie(e,r,{cancelable:n});return o.slice().forEach(i=>{i.call(t,l)}),!l.defaultPrevented}return!0}}const H=[],se=[];let L=[];const ue=[],Ne=Promise.resolve();let J=!1;function Te(){J||(J=!0,Ne.then(we))}function Q(t){L.push(t)}const G=new Set;let I=0;function we(){if(I!==0)return;const t=T;do{try{for(;I<H.length;){const e=H[I];I++,N(e),xe(e.$$)}}catch(e){throw H.length=0,I=0,e}for(N(null),H.length=0,I=0;se.length;)se.pop()();for(let e=0;e<L.length;e+=1){const r=L[e];G.has(r)||(G.add(r),r())}L.length=0}while(H.length);for(;ue.length;)ue.pop()();J=!1,G.clear(),N(t)}function xe(t){if(t.fragment!==null){t.update(),x(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Q)}}function Ae(t){const e=[],r=[];L.forEach(n=>t.indexOf(n)===-1?e.push(n):r.push(n)),r.forEach(n=>n()),L=e}const O=new Set;let S;function ne(){S={r:0,c:[],p:S}}function re(){S.r||x(S.c),S=S.p}function p(t,e){t&&t.i&&(O.delete(t),t.i(e))}function P(t,e,r,n){if(t&&t.o){if(O.has(t))return;O.add(t),S.c.push(()=>{O.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}else n&&n()}function B(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function oe(t){t&&t.c()}function D(t,e,r){const{fragment:n,after_update:o}=t.$$;n&&n.m(e,r),Q(()=>{const l=t.$$.on_mount.map(ge).filter(pe);t.$$.on_destroy?t.$$.on_destroy.push(...l):x(l),t.$$.on_mount=[]}),o.forEach(Q)}function Y(t,e){const r=t.$$;r.fragment!==null&&(Ae(r.after_update),x(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function Re(t,e){t.$$.dirty[0]===-1&&(H.push(t),Te(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function q(t,e,r,n,o,l,i=null,c=[-1]){const s=T;N(t);const u=t.$$={fragment:null,ctx:[],props:l,update:v,not_equal:o,bound:le(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:le(),dirty:c,skip_bound:!1,root:e.target||s.$$.root};i&&i(u.root);let f=!1;if(u.ctx=r?r(t,e.props||{},(a,d,...g)=>{const b=g.length?g[0]:d;return u.ctx&&o(u.ctx[a],u.ctx[a]=b)&&(!u.skip_bound&&u.bound[a]&&u.bound[a](b),f&&Re(t,a)),d}):[],u.update(),f=!0,x(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){const a=Se(e.target);u.fragment&&u.fragment.l(a),a.forEach(_)}else u.fragment&&u.fragment.c();e.intro&&p(t.$$.fragment),D(t,e.target,e.anchor),we()}N(s)}class F{constructor(){K(this,"$$");K(this,"$$set")}$destroy(){Y(this,1),this.$destroy=v}$on(e,r){if(!pe(r))return v;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{const o=n.indexOf(r);o!==-1&&n.splice(o,1)}}$set(e){this.$$set&&!ke(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const We="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(We);function ye(t){return t<=600}function ce(t,e,r){const n=t.slice();return n[8]=e[r],n}function ae(t){let e,r,n,o,l,i,c;return{c(){e=E("a"),r=E("img"),l=be(),h(r,"class","thumbnail svelte-8ifd7i"),X(r.src,n=t[8].url)||h(r,"src",n),h(r,"alt",o="img "+t[8].id),h(e,"id",i=`thumbnail-${t[8].id}`),h(e,"href",c=t[8].url),h(e,"class","thumbnail-wrapper svelte-8ifd7i"),W(e,"left",t[8].posX+"px"),W(e,"top",t[8].posY+"px")},m(s,u){w(s,e,u),V(e,r),V(e,l)},p(s,u){u&1&&!X(r.src,n=s[8].url)&&h(r,"src",n),u&1&&o!==(o="img "+s[8].id)&&h(r,"alt",o),u&1&&i!==(i=`thumbnail-${s[8].id}`)&&h(e,"id",i),u&1&&c!==(c=s[8].url)&&h(e,"href",c),u&1&&W(e,"left",s[8].posX+"px"),u&1&&W(e,"top",s[8].posY+"px")},d(s){s&&_(e)}}}function Oe(t){let e,r=B(t[0]),n=[];for(let o=0;o<r.length;o+=1)n[o]=ae(ce(t,r,o));return{c(){e=E("div");for(let o=0;o<n.length;o+=1)n[o].c()},m(o,l){w(o,e,l);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,[l]){if(l&1){r=B(o[0]);let i;for(i=0;i<r.length;i+=1){const c=ce(o,r,i);n[i]?n[i].p(c,l):(n[i]=ae(c),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=r.length}},i:v,o:v,d(o){o&&_(e),_e(n,o)}}}const M=30;function Xe(t,e,r,n,o,l){return!(t+(o+M)<=r||r+(o+M)<=t||e+(l+M)<=n||n+(l+M)<=e)}function Be(){const t=document.querySelector(".thumbnail");if(!t)return{tMaxWidth:100,tMaxHeight:100};const e=window.getComputedStyle(t),r=parseInt(e.maxWidth)||100,n=parseInt(e.maxHeight)||100;return{tMaxWidth:r,tMaxHeight:n}}function je(t,e,r){let{pageNumber:n}=e,{pageHeight:o}=e,{pageWidth:l}=e,{thumbnails:i=[]}=e;const c=Le();te(async()=>{r(0,i=u()),c("pageRendered",{thumbnailCount:i.length})});function s(){let a=M,d=M;return n==0?{topStart:d,leftStart:a}:(ye(l)?d+=n*o:a+=n*l,{topStart:d,leftStart:a})}function u(){const d=[],g=[],{tMaxWidth:b,tMaxHeight:C}=Be(),{topStart:m,leftStart:y}=s();return i.forEach($=>{let k,A,ie;const U=document.getElementById(`thumbnail-${$.id}`);if(!U)throw new Error(`Cannot find elem thumbnail-${$.id} to set randomised position.`);let z=0;do({posX:k,posY:A}=f(y,m,C,b)),ie=d.some(({posX:$e,posY:ve})=>Xe(k,A,$e,ve,b,C)),z++;while(ie&&z<50);d.push({element:U,posX:k,posY:A}),z>=50&&(console.warn(`Skipping thumbnail ${$.id} due to space constraints.`),U.style.display="none"),g.push({...$,posX:k,posY:A})}),g}function f(a,d,g,b){let C=d+o-M-g,m=a+l-M-b;return{posX:Math.floor(Math.random()*(m-a)+a),posY:Math.floor(Math.random()*(C-d)+d)}}return t.$$set=a=>{"pageNumber"in a&&r(1,n=a.pageNumber),"pageHeight"in a&&r(2,o=a.pageHeight),"pageWidth"in a&&r(3,l=a.pageWidth),"thumbnails"in a&&r(0,i=a.thumbnails)},[i,n,o,l]}class De extends F{constructor(e){super(),q(this,e,je,Oe,j,{pageNumber:1,pageHeight:2,pageWidth:3,thumbnails:0})}}function fe(t,e,r){const n=t.slice();return n[1]=e[r].thumbnails,n[14]=r,n}function de(t){let e,r,n=B(t[0]),o=[];for(let i=0;i<n.length;i+=1)o[i]=he(fe(t,n,i));const l=i=>P(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Me()},m(i,c){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(i,c);w(i,e,c),r=!0},p(i,c){if(c&29){n=B(i[0]);let s;for(s=0;s<n.length;s+=1){const u=fe(i,n,s);o[s]?(o[s].p(u,c),p(o[s],1)):(o[s]=he(u),o[s].c(),p(o[s],1),o[s].m(e.parentNode,e))}for(ne(),s=n.length;s<o.length;s+=1)l(s);re()}},i(i){if(!r){for(let c=0;c<n.length;c+=1)p(o[c]);r=!0}},o(i){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)P(o[c]);r=!1},d(i){i&&_(e),_e(o,i)}}}function he(t){let e,r;return e=new De({props:{thumbnails:t[1],pageNumber:t[14],pageHeight:t[3],pageWidth:t[2]}}),e.$on("pageRendered",t[4]),{c(){oe(e.$$.fragment)},m(n,o){D(e,n,o),r=!0},p(n,o){const l={};o&1&&(l.thumbnails=n[1]),e.$set(l)},i(n){r||(p(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){Y(e,n)}}}function Ye(t){let e,r,n=t[1].length&&de(t);return{c(){e=E("div"),n&&n.c(),h(e,"id","photos-wrapper"),h(e,"class","svelte-18731qk")},m(o,l){w(o,e,l),n&&n.m(e,null),r=!0},p(o,[l]){o[1].length?n?(n.p(o,l),l&2&&p(n,1)):(n=de(o),n.c(),p(n,1),n.m(e,null)):n&&(ne(),P(n,1,1,()=>{n=null}),re())},i(o){r||(p(n),r=!0)},o(o){P(n),r=!1},d(o){o&&_(e),n&&n.d()}}}const me=5,qe="https://rkimmiblogserver.fly.dev/api/photos-blog/thumbnails";function Fe(t,e,r){const n=window.innerWidth,o=window.innerHeight;let l=[],i=0,c="",s=[],u=!1,f=!1;function a(m){i+=m.detail.thumbnailCount,g()}async function d(){if(u)return;u=!0;let y=3*me;await C(y),g(),u=!1}function g(){if(i>=s.length)return;const m=s.slice(i,i+me);i++,r(0,l=[...l,{pageStart:i,thumbnails:m}])}te(async()=>{await d(),window.addEventListener("scroll",b)}),He(()=>{window.removeEventListener("scroll",b)});function b(){let m=0,y=0;ye(n)?(m=window.scrollY+window.innerHeight,y=l.length*o-o):(m=window.scrollX+window.innerWidth,y=l.length*n-n),m>=y&&d()}async function C(m){if(f)return;const y=`${qe}?folder=photos-blog&limit=${m}&startKey=${c}`;try{let k=await(await fetch(y)).json();r(1,s=[...s,...k.images]),c=k.nextPageStart,k.nextPageStart===""&&(console.log("All thumbnails loaded, total: "+s.length),f=!0)}catch($){console.error("Error loading thumbnails:",$)}}return[l,s,n,o,a]}class Ue extends F{constructor(e){super(),q(this,e,Fe,Ye,j,{})}}function ze(t){let e;return{c(){e=E("div"),e.textContent="wip photo preview"},m(r,n){w(r,e,n)},p:v,d(r){r&&_(e)}}}function Ke(t){let e,r=t[0].title+"",n,o,l,i,c;return{c(){e=E("h1"),n=Z(r),o=be(),l=E("img"),X(l.src,i=t[0].url)||h(l,"src",i),h(l,"alt",c=t[0].title)},m(s,u){w(s,e,u),V(e,n),w(s,o,u),w(s,l,u)},p(s,u){u&1&&r!==(r=s[0].title+"")&&Ce(n,r),u&1&&!X(l.src,i=s[0].url)&&h(l,"src",i),u&1&&c!==(c=s[0].title)&&h(l,"alt",c)},d(s){s&&(_(e),_(o),_(l))}}}function Ge(t){let e;function r(l,i){return l[0]?Ke:ze}let n=r(t),o=n(t);return{c(){e=E("div"),o.c()},m(l,i){w(l,e,i),o.m(e,null)},p(l,[i]){n===(n=r(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e,null)))},i:v,o:v,d(l){l&&_(e),o.d()}}}function Ve(t,e,r){let{id:n}=e,o;return te(async()=>{if(!o){const l=await fetch(`/api/photos/${n}`);r(0,o=await l.json())}}),t.$$set=l=>{"id"in l&&r(1,n=l.id)},[o,n]}class Je extends F{constructor(e){super(),q(this,e,Ve,Ge,j,{id:1})}}function Qe(t){let e,r;return e=new Ue({}),{c(){oe(e.$$.fragment)},m(n,o){D(e,n,o),r=!0},p:v,i(n){r||(p(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){Y(e,n)}}}function Ze(t){let e,r;return e=new Je({props:{id:t[0]}}),{c(){oe(e.$$.fragment)},m(n,o){D(e,n,o),r=!0},p(n,o){const l={};o&1&&(l.id=n[0]),e.$set(l)},i(n){r||(p(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){Y(e,n)}}}function et(t){let e,r,n,o;const l=[Ze,Qe],i=[];function c(s,u){var f;return(f=s[0])!=null&&f.length?0:1}return r=c(t),n=i[r]=l[r](t),{c(){e=E("main"),n.c(),h(e,"class","svelte-1tyzdic")},m(s,u){w(s,e,u),i[r].m(e,null),o=!0},p(s,[u]){let f=r;r=c(s),r===f?i[r].p(s,u):(ne(),P(i[f],1,1,()=>{i[f]=null}),re(),n=i[r],n?n.p(s,u):(n=i[r]=l[r](s),n.c()),p(n,1),n.m(e,null))},i(s){o||(p(n),o=!0)},o(s){P(n),o=!1},d(s){s&&_(e),i[r].d()}}}function tt(t,e,r){let{url:n=""}=e,{photoIdParam:o=null}=e;addEventListener("DOMContentLoaded",()=>{const c=new URLSearchParams(window.location.search);r(0,o=c.get("photo"));const s=document.getElementsByTagName("body")[0],[u,f]=i();s.style.backgroundColor=u,s.style.color=f});const l=new Map([[0,["#ffc0c0","white"]],[12,["#ffffaa","brown"]],[16,["#8affc8","black"]],[20,["#ceceff","white"]]]);function i(){let c="",s="";const f=new Date().getHours();for(let[a,[d,g]]of l)if(f>=a)c=d,s=g;else break;return[c,s]}return t.$$set=c=>{"url"in c&&r(1,n=c.url),"photoIdParam"in c&&r(0,o=c.photoIdParam)},[o,n]}class nt extends F{constructor(e){super(),q(this,e,tt,et,j,{url:1,photoIdParam:0})}}new nt({target:document.getElementById("app")});
