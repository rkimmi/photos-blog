var Ee=Object.defineProperty;var Pe=(t,e,r)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var F=(t,e,r)=>Pe(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();function v(){}function ge(t){return t()}function le(){return Object.create(null)}function H(t){t.forEach(ge)}function pe(t){return typeof t=="function"}function j(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let T;function B(t,e){return t===e?!0:(T||(T=document.createElement("a")),T.href=e,t===T.href)}function Se(t){return Object.keys(t).length===0}function V(t,e){t.appendChild(e)}function w(t,e,r){t.insertBefore(e,r||null)}function p(t){t.parentNode&&t.parentNode.removeChild(t)}function _e(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function E(t){return document.createElement(t)}function Z(t){return document.createTextNode(t)}function be(){return Z(" ")}function Me(){return Z("")}function f(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function ke(t){return Array.from(t.childNodes)}function Ie(t,e){e=""+e,t.data!==e&&(t.data=e)}function W(t,e,r,n){r==null?t.style.removeProperty(e):t.style.setProperty(e,r,"")}function Le(t,e,{bubbles:r=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:r,cancelable:n})}let A;function x(t){A=t}function ee(){if(!A)throw new Error("Function called outside component initialization");return A}function te(t){ee().$$.on_mount.push(t)}function Ne(t){ee().$$.on_destroy.push(t)}function Ce(){const t=ee();return(e,r,{cancelable:n=!1}={})=>{const i=t.$$.callbacks[e];if(i){const l=Le(e,r,{cancelable:n});return i.slice().forEach(o=>{o.call(t,l)}),!l.defaultPrevented}return!0}}const N=[],se=[];let C=[];const ue=[],xe=Promise.resolve();let J=!1;function Ae(){J||(J=!0,xe.then(we))}function Q(t){C.push(t)}const G=new Set;let L=0;function we(){if(L!==0)return;const t=A;do{try{for(;L<N.length;){const e=N[L];L++,x(e),He(e.$$)}}catch(e){throw N.length=0,L=0,e}for(x(null),N.length=0,L=0;se.length;)se.pop()();for(let e=0;e<C.length;e+=1){const r=C[e];G.has(r)||(G.add(r),r())}C.length=0}while(N.length);for(;ue.length;)ue.pop()();J=!1,G.clear(),x(t)}function He(t){if(t.fragment!==null){t.update(),H(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Q)}}function Re(t){const e=[],r=[];C.forEach(n=>t.indexOf(n)===-1?e.push(n):r.push(n)),r.forEach(n=>n()),C=e}const O=new Set;let k;function ne(){k={r:0,c:[],p:k}}function re(){k.r||H(k.c),k=k.p}function g(t,e){t&&t.i&&(O.delete(t),t.i(e))}function P(t,e,r,n){if(t&&t.o){if(O.has(t))return;O.add(t),k.c.push(()=>{O.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}else n&&n()}function X(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ie(t){t&&t.c()}function Y(t,e,r){const{fragment:n,after_update:i}=t.$$;n&&n.m(e,r),Q(()=>{const l=t.$$.on_mount.map(ge).filter(pe);t.$$.on_destroy?t.$$.on_destroy.push(...l):H(l),t.$$.on_mount=[]}),i.forEach(Q)}function q(t,e){const r=t.$$;r.fragment!==null&&(Re(r.after_update),H(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function Te(t,e){t.$$.dirty[0]===-1&&(N.push(t),Ae(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function U(t,e,r,n,i,l,o=null,c=[-1]){const s=A;x(t);const u=t.$$={fragment:null,ctx:[],props:l,update:v,not_equal:i,bound:le(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:le(),dirty:c,skip_bound:!1,root:e.target||s.$$.root};o&&o(u.root);let h=!1;if(u.ctx=r?r(t,e.props||{},(a,d,..._)=>{const b=_.length?_[0]:d;return u.ctx&&i(u.ctx[a],u.ctx[a]=b)&&(!u.skip_bound&&u.bound[a]&&u.bound[a](b),h&&Te(t,a)),d}):[],u.update(),h=!0,H(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){const a=ke(e.target);u.fragment&&u.fragment.l(a),a.forEach(p)}else u.fragment&&u.fragment.c();e.intro&&g(t.$$.fragment),Y(t,e.target,e.anchor),we()}x(s)}class z{constructor(){F(this,"$$");F(this,"$$set")}$destroy(){q(this,1),this.$destroy=v}$on(e,r){if(!pe(r))return v;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{const i=n.indexOf(r);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!Se(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const We="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(We);function $e(t){return t<=600}function ce(t,e,r){const n=t.slice();return n[8]=e[r],n}function ae(t){let e,r,n,i,l,o,c;return{c(){e=E("a"),r=E("img"),l=be(),f(r,"class","thumbnail svelte-8ifd7i"),B(r.src,n=t[8].url)||f(r,"src",n),f(r,"alt",i="img "+t[8].id),f(e,"id",o=`thumbnail-${t[8].id}`),f(e,"href",c=t[8].url),f(e,"class","thumbnail-wrapper svelte-8ifd7i"),W(e,"left",t[8].posX+"px"),W(e,"top",t[8].posY+"px")},m(s,u){w(s,e,u),V(e,r),V(e,l)},p(s,u){u&1&&!B(r.src,n=s[8].url)&&f(r,"src",n),u&1&&i!==(i="img "+s[8].id)&&f(r,"alt",i),u&1&&o!==(o=`thumbnail-${s[8].id}`)&&f(e,"id",o),u&1&&c!==(c=s[8].url)&&f(e,"href",c),u&1&&W(e,"left",s[8].posX+"px"),u&1&&W(e,"top",s[8].posY+"px")},d(s){s&&p(e)}}}function Oe(t){let e,r=X(t[0]),n=[];for(let i=0;i<r.length;i+=1)n[i]=ae(ce(t,r,i));return{c(){e=E("div");for(let i=0;i<n.length;i+=1)n[i].c()},m(i,l){w(i,e,l);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null)},p(i,[l]){if(l&1){r=X(i[0]);let o;for(o=0;o<r.length;o+=1){const c=ce(i,r,o);n[o]?n[o].p(c,l):(n[o]=ae(c),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=r.length}},i:v,o:v,d(i){i&&p(e),_e(n,i)}}}const M=30;function Be(t,e,r,n,i,l){return!(t+(i+M)<=r||r+(i+M)<=t||e+(l+M)<=n||n+(l+M)<=e)}function Xe(){const t=document.querySelector(".thumbnail");if(!t)return{tMaxWidth:100,tMaxHeight:100};const e=window.getComputedStyle(t),r=parseInt(e.maxWidth)||100,n=parseInt(e.maxHeight)||100;return{tMaxWidth:r,tMaxHeight:n}}function je(t,e,r){let{pageNumber:n}=e,{pageHeight:i}=e,{pageWidth:l}=e,{thumbnails:o=[]}=e;const c=Ce();te(async()=>{r(0,o=u()),c("pageRendered",{thumbnailCount:o.length})});function s(){let a=M,d=M;return n==0?{topStart:d,leftStart:a}:($e(l)?d+=n*i:a+=n*l,{topStart:d,leftStart:a})}function u(){const d=[],_=[],{tMaxWidth:b,tMaxHeight:I}=Xe(),{topStart:m,leftStart:$}=s();return o.forEach(y=>{let S,R,oe;const D=document.getElementById(`thumbnail-${y.id}`);if(!D)throw new Error(`Cannot find elem thumbnail-${y.id} to set randomised position.`);let K=0;do({posX:S,posY:R}=h($,m,I,b)),oe=d.some(({posX:ye,posY:ve})=>Be(S,R,ye,ve,b,I)),K++;while(oe&&K<50);d.push({element:D,posX:S,posY:R}),K>=50&&(console.warn(`Skipping thumbnail ${y.id} due to space constraints.`),D.style.display="none"),_.push({...y,posX:S,posY:R})}),_}function h(a,d,_,b){let I=d+i-M-_,m=a+l-M-b;return{posX:Math.floor(Math.random()*(m-a)+a),posY:Math.floor(Math.random()*(I-d)+d)}}return t.$$set=a=>{"pageNumber"in a&&r(1,n=a.pageNumber),"pageHeight"in a&&r(2,i=a.pageHeight),"pageWidth"in a&&r(3,l=a.pageWidth),"thumbnails"in a&&r(0,o=a.thumbnails)},[o,n,i,l]}class Ye extends z{constructor(e){super(),U(this,e,je,Oe,j,{pageNumber:1,pageHeight:2,pageWidth:3,thumbnails:0})}}function fe(t,e,r){const n=t.slice();return n[1]=e[r].thumbnails,n[14]=r,n}function de(t){let e,r,n=X(t[0]),i=[];for(let o=0;o<n.length;o+=1)i[o]=he(fe(t,n,o));const l=o=>P(i[o],1,1,()=>{i[o]=null});return{c(){for(let o=0;o<i.length;o+=1)i[o].c();e=Me()},m(o,c){for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(o,c);w(o,e,c),r=!0},p(o,c){if(c&29){n=X(o[0]);let s;for(s=0;s<n.length;s+=1){const u=fe(o,n,s);i[s]?(i[s].p(u,c),g(i[s],1)):(i[s]=he(u),i[s].c(),g(i[s],1),i[s].m(e.parentNode,e))}for(ne(),s=n.length;s<i.length;s+=1)l(s);re()}},i(o){if(!r){for(let c=0;c<n.length;c+=1)g(i[c]);r=!0}},o(o){i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)P(i[c]);r=!1},d(o){o&&p(e),_e(i,o)}}}function he(t){let e,r;return e=new Ye({props:{thumbnails:t[1],pageNumber:t[14],pageHeight:t[3],pageWidth:t[2]}}),e.$on("pageRendered",t[4]),{c(){ie(e.$$.fragment)},m(n,i){Y(e,n,i),r=!0},p(n,i){const l={};i&1&&(l.thumbnails=n[1]),e.$set(l)},i(n){r||(g(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){q(e,n)}}}function qe(t){let e,r,n=t[1].length&&de(t);return{c(){e=E("div"),n&&n.c(),f(e,"id","photos-wrapper"),f(e,"class","svelte-18731qk")},m(i,l){w(i,e,l),n&&n.m(e,null),r=!0},p(i,[l]){i[1].length?n?(n.p(i,l),l&2&&g(n,1)):(n=de(i),n.c(),g(n,1),n.m(e,null)):n&&(ne(),P(n,1,1,()=>{n=null}),re())},i(i){r||(g(n),r=!0)},o(i){P(n),r=!1},d(i){i&&p(e),n&&n.d()}}}const me=5,Ue="https://rkimmiblogserver.fly.dev/api/photos-blog/thumbnails";function ze(t,e,r){const n=window.innerWidth,i=window.innerHeight;let l=[],o=0,c="",s=[],u=!1,h=!1;function a(m){o+=m.detail.thumbnailCount,_()}async function d(){if(u)return;u=!0;let $=2*me;await I($),_(),u=!1}function _(){if(o>=s.length)return;const m=s.slice(o,o+me);o++,r(0,l=[...l,{pageStart:o,thumbnails:m}])}te(async()=>{await d(),window.addEventListener("scroll",b)}),Ne(()=>{window.removeEventListener("scroll",b)});function b(){let m=0,$=0;$e(n)?(m=window.scrollY+window.innerHeight,$=l.length*i-i):(m=window.scrollX+window.innerWidth,$=l.length*n-n),m>=$&&d()}async function I(m){if(h)return;const $=`${Ue}?folder=photos-blog&limit=${m}&startKey=${c}`;try{let S=await(await fetch($)).json();r(1,s=[...s,...S.images]),c=S.nextPageStart,S.nextPageStart===""&&(console.log("All thumbnails loaded, total: "+s.length),h=!0)}catch(y){console.error("Error loading thumbnails:",y)}}return[l,s,n,i,a]}class De extends z{constructor(e){super(),U(this,e,ze,qe,j,{})}}function Ke(t){let e;return{c(){e=E("div"),e.textContent="wip photo preview"},m(r,n){w(r,e,n)},p:v,d(r){r&&p(e)}}}function Fe(t){let e,r=t[0].title+"",n,i,l,o,c;return{c(){e=E("h1"),n=Z(r),i=be(),l=E("img"),B(l.src,o=t[0].url)||f(l,"src",o),f(l,"alt",c=t[0].title)},m(s,u){w(s,e,u),V(e,n),w(s,i,u),w(s,l,u)},p(s,u){u&1&&r!==(r=s[0].title+"")&&Ie(n,r),u&1&&!B(l.src,o=s[0].url)&&f(l,"src",o),u&1&&c!==(c=s[0].title)&&f(l,"alt",c)},d(s){s&&(p(e),p(i),p(l))}}}function Ge(t){let e;function r(l,o){return l[0]?Fe:Ke}let n=r(t),i=n(t);return{c(){e=E("div"),i.c()},m(l,o){w(l,e,o),i.m(e,null)},p(l,[o]){n===(n=r(l))&&i?i.p(l,o):(i.d(1),i=n(l),i&&(i.c(),i.m(e,null)))},i:v,o:v,d(l){l&&p(e),i.d()}}}function Ve(t,e,r){let{id:n}=e,i;return te(async()=>{if(!i){const l=await fetch(`/api/photos/${n}`);r(0,i=await l.json())}}),t.$$set=l=>{"id"in l&&r(1,n=l.id)},[i,n]}class Je extends z{constructor(e){super(),U(this,e,Ve,Ge,j,{id:1})}}function Qe(t){let e,r;return e=new De({}),{c(){ie(e.$$.fragment)},m(n,i){Y(e,n,i),r=!0},p:v,i(n){r||(g(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){q(e,n)}}}function Ze(t){let e,r;return e=new Je({props:{id:t[0]}}),{c(){ie(e.$$.fragment)},m(n,i){Y(e,n,i),r=!0},p(n,i){const l={};i&1&&(l.id=n[0]),e.$set(l)},i(n){r||(g(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){q(e,n)}}}function et(t){let e,r,n,i;const l=[Ze,Qe],o=[];function c(s,u){var h;return(h=s[0])!=null&&h.length?0:1}return r=c(t),n=o[r]=l[r](t),{c(){e=E("main"),n.c(),f(e,"class","svelte-1tyzdic")},m(s,u){w(s,e,u),o[r].m(e,null),i=!0},p(s,[u]){let h=r;r=c(s),r===h?o[r].p(s,u):(ne(),P(o[h],1,1,()=>{o[h]=null}),re(),n=o[r],n?n.p(s,u):(n=o[r]=l[r](s),n.c()),g(n,1),n.m(e,null))},i(s){i||(g(n),i=!0)},o(s){P(n),i=!1},d(s){s&&p(e),o[r].d()}}}function tt(t,e,r){let{photoIdParam:n=null}=e;addEventListener("DOMContentLoaded",()=>{const c=new URLSearchParams(window.location.search);r(0,n=c.get("photo")),i()});function i(){const c=document.getElementsByTagName("body")[0],s=o();c.style.backgroundColor=s}const l=new Map([["light","#c9ceda"],["dark","#363d51"]]);function o(){let c=localStorage.getItem("theme");return c||(c="light"),l.get(c)}return t.$$set=c=>{"photoIdParam"in c&&r(0,n=c.photoIdParam)},[n]}class nt extends z{constructor(e){super(),U(this,e,tt,et,j,{photoIdParam:0})}}new nt({target:document.getElementById("app")});
